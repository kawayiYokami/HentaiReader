<!DOCTYPE html>
<html lang="zh-CN">
{% include 'components/layout/html-head.html' %}

<body>
    <div id="app">
        {% include 'components/layout/app-container.html' %}

        {% include 'components/layout/hidden-elements.html' %}

        {% include 'components/dialogs/edit-dialog.html' %}
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox, ElLoading } = ElementPlus;

        // 等待所有模块加载完成
        document.addEventListener('DOMContentLoaded', function() {
            // 检查必要的模块是否已加载
            if (!window.AppData) {
                console.error('AppData模块未加载');
                return;
            }

            try {
                const app = createApp({
                    data() {
                        return window.AppData;
                    },
                    computed: window.AppComputed || {},
                    mounted() {
                        if (window.AppLifecycle && window.AppLifecycle.mounted) {
                            window.AppLifecycle.mounted.call(this);
                        }
                    },
                    beforeUnmount() {
                        if (window.AppLifecycle && window.AppLifecycle.beforeUnmount) {
                            window.AppLifecycle.beforeUnmount.call(this);
                        }
                    },
                    methods: {
                        // 合并所有功能模块的方法
                        ...(window.UtilsMethods || {}),
                        ...(window.MangaBrowserMethods || {}),
                        ...(window.CacheManagementMethods || {}),
                        ...(window.TranslationMethods || {}),
                        ...(window.CompressionMethods || {}),

                        // 所有方法已通过模块导入，无需重复定义
                    }
                });

                app.use(ElementPlus);

                // 注册Element Plus图标
                if (window.ElementPlusIconsVue) {
                    const { Delete, UploadFilled } = window.ElementPlusIconsVue;
                    app.component('Delete', Delete);
                    app.component('UploadFilled', UploadFilled);
                }

                app.mount('#app');
            } catch (error) {
                console.error('Vue应用启动失败:', error);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
{% include 'components/layout/html-head.html' %}

<body>
    <div id="app">
        {% include 'components/layout/app-container.html' %}

        {% include 'components/layout/hidden-elements.html' %}

        {% include 'components/dialogs/edit-dialog.html' %}
        {% include 'components/dialogs/harmonization-dialog.html' %}
        {% include 'components/dialogs/batch-compression-dialog.html' %}
        {% include 'components/dialogs/auto-filter-dialog.html' %}
        {% include 'components/dialogs/compression-warning-dialog.html' %}
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox, ElLoading } = ElementPlus;

        // ç»Ÿä¸€æ—¥å¿—å‡½æ•°
        function log(level, message) {
            if (window.jsLog) {
                window.jsLog(level, message);
            } else {
                console.log(`[${level.toUpperCase()}] ${message}`);
            }
        }

        // åŸºç¡€è°ƒè¯•ä¿¡æ¯ï¼ˆä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰
        if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
            log('info', 'ğŸš€ HTMLé¡µé¢å¼€å§‹åŠ è½½JavaScript...');
            log('info', 'ğŸ” Vueå­˜åœ¨: ' + !!window.Vue);
            log('info', 'ğŸ” ElementPluså­˜åœ¨: ' + !!window.ElementPlus);
        }

        // ç­‰å¾…æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            // å¼€å‘æ¨¡å¼ä¸‹çš„è°ƒè¯•ä¿¡æ¯
            if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
                log('info', 'ğŸš€ DOMContentLoadedäº‹ä»¶è§¦å‘');
                log('info', 'ğŸ” window.AppDataå­˜åœ¨: ' + !!window.AppData);
                log('info', 'ğŸ” window.AppLifecycleå­˜åœ¨: ' + !!window.AppLifecycle);
                log('info', 'ğŸ” window.MangaBrowserMethodså­˜åœ¨: ' + !!window.MangaBrowserMethods);
            }

            // æ£€æŸ¥å¿…è¦çš„æ¨¡å—æ˜¯å¦å·²åŠ è½½
            if (!window.AppData) {
                log('error', 'âŒ AppDataæ¨¡å—æœªåŠ è½½');
                return;
            }

            try {
                const app = createApp({
                    data() {
                        return window.AppData;
                    },
                    computed: window.AppComputed || {},
                    mounted() {
                        if (window.AppLifecycle && window.AppLifecycle.mounted) {
                            window.AppLifecycle.mounted.call(this);
                        }
                    },
                    beforeUnmount() {
                        if (window.AppLifecycle && window.AppLifecycle.beforeUnmount) {
                            window.AppLifecycle.beforeUnmount.call(this);
                        }
                    },
                    methods: {
                        // åˆå¹¶æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„æ–¹æ³•
                        ...(window.UtilsMethods || {}),
                        ...(window.MangaBrowserMethods || {}),
                        ...(window.CacheManagementMethods || {}),
                        ...(window.TranslationMethods || {}),
                        ...(window.CompressionMethods || {}),

                        // æ‰€æœ‰æ–¹æ³•å·²é€šè¿‡æ¨¡å—å¯¼å…¥ï¼Œæ— éœ€é‡å¤å®šä¹‰
                    }
                });

                app.use(ElementPlus);

                // æ³¨å†ŒElement Pluså›¾æ ‡
                if (window.ElementPlusIconsVue) {
                    const { Delete, UploadFilled, Loading } = window.ElementPlusIconsVue;
                    app.component('Delete', Delete);
                    app.component('UploadFilled', UploadFilled);
                    app.component('Loading', Loading);
                }

                app.mount('#app');
            } catch (error) {
                console.error('Vueåº”ç”¨å¯åŠ¨å¤±è´¥:', error);
            }
        });
    </script>
</body>
</html>

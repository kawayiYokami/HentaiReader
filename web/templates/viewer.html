<!DOCTYPE html>
<html lang="zh-CN" class="theme-dark" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漫画查看器</title>
    
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="/static/css/modern-theme.css">
    <link rel="stylesheet" href="/static/css/viewer.css">

</head>
<body>
    <div id="app">
        <!-- 左侧控制栏 -->
        <div class="left-sidebar">

            <!-- 漫画标题 -->
            <div class="manga-title-section">
                <div class="manga-title-vertical">{{ mangaInfo.title || '加载中...' }}</div>
            </div>

            <!-- 显示模式切换 -->
            <div class="display-mode-section">
                <el-button
                    @click="toggleDisplayMode"
                    type="primary"
                    text
                    class="mode-btn">
                    {{ actualDisplayMode === 'single' ? '单页' : '双页' }}
                </el-button>
            </div>

            <!-- 翻译开关 -->
            <div class="translation-section">
                <el-button
                    @click="toggleTranslation"
                    type="primary"
                    text
                    :class="['translation-btn', { 'translation-active': translationEnabled }]">
                    译
                </el-button>
            </div>

            <!-- 页面导航 -->
            <div class="page-navigation">
                <el-button
                    @click="previousPage"
                    :disabled="currentPage <= 0"
                    type="primary"
                    class="nav-btn">
                    ↑
                </el-button>

                <div class="page-info-section">
                    <!-- 页码显示和输入 -->
                    <div class="page-display" @click="showPageInput = true" v-if="!showPageInput">
                        <div class="current-page">{{ currentPage + 1 }}</div>
                        <div class="page-divider">/</div>
                        <div class="total-pages">{{ mangaInfo.total_pages || 0 }}</div>
                    </div>

                    <!-- 页码输入框（点击时显示） -->
                    <div class="page-input-wrapper" v-if="showPageInput">
                        <el-input
                            v-model="pageInputText"
                            size="small"
                            @blur="onPageInputBlur"
                            @keyup.enter="onPageInputEnter"
                            @keyup.escape="cancelPageInput"
                            ref="pageInputRef"
                            class="page-input">
                        </el-input>
                        <div class="page-divider">/</div>
                        <div class="total-pages">{{ mangaInfo.total_pages || 0 }}</div>
                    </div>

                    <!-- 圆形进度条 -->
                    <div class="progress-circle">
                        <svg width="60" height="60" class="progress-svg">
                            <circle cx="30" cy="30" r="25" class="progress-bg"></circle>
                            <circle cx="30" cy="30" r="25" class="progress-fill"
                                    :stroke-dasharray="progressCircumference"
                                    :stroke-dashoffset="progressOffset"></circle>
                        </svg>
                        <div class="progress-text">{{ Math.round(progressPercentage) }}%</div>
                    </div>

                    <!-- 极简滑动条 -->
                    <div class="progress-slider-section">
                        <div class="progress-slider-wrapper">
                            <div class="page-slider-container" @click="onTrackClick" ref="sliderContainer">
                                <div class="page-slider-track">
                                    <div class="page-slider-thumb" 
                                         :style="thumbStyle"
                                         @mousedown.stop="onThumbMouseDown">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <el-button
                    @click="nextPage"
                    :disabled="currentPage >= (mangaInfo.total_pages || 1) - 1"
                    type="primary"
                    class="nav-btn">
                    ↓
                </el-button>
            </div>

            <!-- 全屏按钮 -->
            <div class="fullscreen-section">
                <el-button @click="toggleFullscreen" type="primary" text class="nav-btn">
                    {{ isFullscreen ? '⊡' : '⊞' }}
                </el-button>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="viewer-content" ref="viewerContent">
            <!-- 加载状态 -->
            <div v-if="isLoading" class="loading-container" v-loading="true" element-loading-text="加载中...">
                <!-- v-loading 指令已应用到此 div -->
            </div>

            <!-- 图片显示区域 -->
            <div v-else-if="currentImageUrls.length > 0" class="image-container" @click="onImageClick">
                <!-- 单页模式 -->
                <img
                    v-if="actualDisplayMode === 'single'"
                    :src="currentImageUrls[0]"
                    :alt="`第 ${currentPage + 1} 页`"
                    class="manga-image single-page"
                    loading="eager"
                    decoding="sync"
                    @load="onImageLoad"
                    @error="onImageError"
                    ref="mangaImage">

                <!-- 双页模式 -->
                <div v-else-if="actualDisplayMode === 'double'" class="double-page-container">
                    <img
                        v-for="(imageUrl, index) in currentImageUrls"
                        :key="currentPage + index"
                        :src="imageUrl"
                        :alt="`第 ${currentPage + index + 1} 页`"
                        class="manga-image double-page"
                        loading="eager"
                        decoding="sync"
                        @load="onImageLoad"
                        @error="onImageError">
                </div>
            </div>
        </div>


    </div>

    <!-- Vue 3 和 Element Plus -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>


    <!-- 简化的查看器管理器 -->
    <script src="/static/js/viewer_manager_simple.js"></script>

    <script>
        const { createApp, ref, reactive, computed, watch, onMounted, onUnmounted, nextTick } = Vue;
        const { ElMessage, ElLoading } = ElementPlus;

        createApp({
            setup() {
                // 极简化响应式数据 - 只保留UI状态
                const mangaInfo = reactive({
                    title: '加载中...',
                    total_pages: 0
                });

                const currentPage = ref(0);
                const showPageInput = ref(false);
                const pageInputText = ref('1');
                const currentImageUrls = ref([]);
                const isLoading = ref(false);
                const isFullscreen = ref(false);
                const displayMode = ref('auto');
                const translationEnabled = ref(false);

                const screenInfo = reactive({
                    width: window.innerWidth,
                    height: window.innerHeight,
                    ratio: window.innerWidth / window.innerHeight
                });

                // DOM引用
                const viewerContent = ref(null);
                const mangaImage = ref(null);
                const pageInputRef = ref(null);
                const sliderContainer = ref(null);
                const isDragging = ref(false);

                // 获取URL参数
                const urlParams = new URLSearchParams(window.location.search);
                const mangaPath = urlParams.get('path');
                const initialPage = parseInt(urlParams.get('page') || '0');

                // 查看器管理器实例
                let viewerManager = null;


                // 计算属性
                const actualDisplayMode = computed(() => {
                    if (displayMode.value === 'single') return 'single';
                    if (displayMode.value === 'double') return 'double';

                    // 自动模式：根据屏幕比例决定
                    // 宽屏显示器 (比例 > 1.5) 且屏幕宽度 > 1200px 时使用双页
                    return (screenInfo.ratio > 1.5 && screenInfo.width > 1200) ? 'double' : 'single';
                });

                const progressPercentage = computed(() => {
                    if (mangaInfo.total_pages === 0) return 0;
                    return ((currentPage.value + 1) / mangaInfo.total_pages) * 100;
                });

                const pagesToLoad = computed(() => {
                    return actualDisplayMode.value === 'double' ? 2 : 1;
                });

                // 圆形进度条计算
                const progressCircumference = computed(() => {
                    return 2 * Math.PI * 25; // 半径25的圆周长
                });

                const progressOffset = computed(() => {
                    const circumference = progressCircumference.value;
                    return circumference - (progressPercentage.value / 100) * circumference;
                });


                
                // 自定义滑块样式
                const thumbStyle = computed(() => {
                    if (!sliderContainer.value || mangaInfo.total_pages <= 1) {
                        return { top: '0px' };
                    }
                    const containerHeight = sliderContainer.value.offsetHeight;
                    const thumbHeight = 30; // 与CSS中设置的高度一致
                    const trackHeight = containerHeight - thumbHeight;
                    const percentage = currentPage.value / (mangaInfo.total_pages - 1);
                    const top = percentage * trackHeight;
                    return {
                        top: `${top}px`
                    };
                });


                // ==================== 初始化 ====================

                onMounted(async () => {
                    if (!mangaPath) {
                        ElMessage.error('缺少漫画路径参数');
                        return;
                    }

                    // 检测桌面应用环境
                    if (isDesktopApp()) {
                        document.body.classList.add('desktop-app');
                    }

                    // 初始化查看器管理器
                    await initializeViewerManager();

                    // 添加事件监听
                    document.addEventListener('keydown', handleKeydown);
                    document.addEventListener('fullscreenchange', handleFullscreenChange);
                    document.addEventListener('wheel', handleWheel, { passive: false });
                    window.addEventListener('resize', handleResize);
                });

                // 检测是否在桌面应用中运行
                function isDesktopApp() {
                    return window.navigator.userAgent.includes('pywebview') ||
                           window.location.protocol === 'file:' ||
                           (!window.opener && !window.parent && window.location.hostname === '127.0.0.1');
                }

                onUnmounted(() => {
                    document.removeEventListener('keydown', handleKeydown);
                    document.removeEventListener('fullscreenchange', handleFullscreenChange);
                    document.removeEventListener('wheel', handleWheel);
                    window.removeEventListener('resize', handleResize);
                });



                // ==================== 查看器管理器初始化 ====================

                async function initializeViewerManager() {
                    try {
                        isLoading.value = true;

                        // 创建查看器会话
                        viewerManager = new ViewerManager();
                        await viewerManager.createSession();

                        // 设置当前漫画
                        const result = await viewerManager.setCurrentManga(mangaPath, initialPage);
                        if (result) {
                            mangaInfo.title = result.manga_info.title;
                            mangaInfo.total_pages = result.manga_info.total_pages;
                            currentPage.value = result.current_page;
                            pageInputText.value = (currentPage.value + 1).toString();
                        }

                        // 加载当前页面
                        await loadCurrentPage();

                    } catch (error) {
                        ElMessage.error('初始化查看器失败');
                    } finally {
                        isLoading.value = false;
                    }
                }

                // ==================== 页面加载 ====================

                async function loadCurrentPage() {
                    try {
                        // 不显示加载状态，避免闪屏
                        // isLoading.value = true;

                        const images = await viewerManager.getPageImages(
                            currentPage.value,
                            actualDisplayMode.value,
                            translationEnabled.value
                        );

                        if (images && images.length > 0) {
                            // 直接更新图像，避免闪屏
                            currentImageUrls.value = images.map(img => img.image_data);
                        } else {
                            throw new Error('无法加载页面图像');
                        }

                    } catch (error) {
                        ElMessage.error(`加载第 ${currentPage.value + 1} 页失败`);
                    } finally {
                        // isLoading.value = false;
                    }
                }

                // ==================== 页面控制 ====================

                function previousPage() {
                    const step = actualDisplayMode.value === 'double' ? 2 : 1;
                    if (currentPage.value > 0) {
                        const newPage = Math.max(0, currentPage.value - step);
                        // 直接跳转，无动画无加载状态
                        currentPage.value = newPage;
                        pageInputText.value = (newPage + 1).toString();
                        loadCurrentPage();
                    }
                }

                function nextPage() {
                    const step = actualDisplayMode.value === 'double' ? 2 : 1;
                    if (currentPage.value < mangaInfo.total_pages - 1) {
                        const newPage = Math.min(mangaInfo.total_pages - 1, currentPage.value + step);
                        // 直接跳转，无动画无加载状态
                        currentPage.value = newPage;
                        pageInputText.value = (newPage + 1).toString();
                        loadCurrentPage();
                    }
                }

                async function onPageChange(newPage) {
                    currentPage.value = newPage;
                    pageInputText.value = (newPage + 1).toString();
                    await loadCurrentPage();
                }

                // ==================== 翻译控制 ====================

                async function toggleTranslation() {
                    try {
                        const newState = !translationEnabled.value;
                        const result = await viewerManager.toggleTranslation(newState);

                        if (result) {
                            translationEnabled.value = newState;
                            await loadCurrentPage(); // 重新加载当前页面
                        }
                    } catch (error) {
                        ElMessage.error('切换翻译状态失败');
                    }
                }

                // ==================== 显示模式控制 ====================

                function toggleDisplayMode() {
                    const modes = ['auto', 'single', 'double'];
                    const currentIndex = modes.indexOf(displayMode.value);
                    const nextIndex = (currentIndex + 1) % modes.length;
                    displayMode.value = modes[nextIndex];

                    // 重新加载当前页面以适应新的显示模式
                    nextTick(() => {
                        loadCurrentPage();
                    });
                }

                // ==================== 页码输入相关方法 ====================

                function onPageInputEnter() {
                    applyPageInput();
                }

                function onPageInputBlur() {
                    applyPageInput();
                }

                function cancelPageInput() {
                    showPageInput.value = false;
                    pageInputText.value = (currentPage.value + 1).toString();
                }

                function applyPageInput() {
                    const newPage = parseInt(pageInputText.value);
                    if (newPage && newPage >= 1 && newPage <= mangaInfo.total_pages) {
                        onPageChange(newPage - 1); // 转换为0-based
                    } else {
                        pageInputText.value = (currentPage.value + 1).toString();
                    }
                    showPageInput.value = false;
                }

                // 监听页码输入框显示状态，自动聚焦
                watch(showPageInput, (newValue) => {
                    if (newValue) {
                        nextTick(() => {
                            if (pageInputRef.value) {
                                pageInputRef.value.focus();
                                pageInputRef.value.select();
                            }
                        });
                    }
                });

                // ==================== 自定义滑块方法 ====================

                function onThumbMouseDown(event) {
                    isDragging.value = true;
                    const thumb = event.target;
                    const container = sliderContainer.value;
                    const initialY = event.clientY;
                    const initialTop = thumb.offsetTop;

                    const onMouseMove = (moveEvent) => {
                        if (!isDragging.value) return;

                        const deltaY = moveEvent.clientY - initialY;
                        let newTop = initialTop + deltaY;

                        const containerHeight = container.offsetHeight;
                        const thumbHeight = thumb.offsetHeight;

                        newTop = Math.max(0, Math.min(newTop, containerHeight - thumbHeight));

                        const percentage = newTop / (containerHeight - thumbHeight);
                        const newPage = Math.round(percentage * (mangaInfo.total_pages - 1));

                        pageInputText.value = (newPage + 1).toString();
                        thumb.style.top = `${newTop}px`;
                    };

                    const onMouseUp = () => {
                        isDragging.value = false;
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);

                        const finalPercentage = thumb.offsetTop / (container.offsetHeight - thumb.offsetHeight);
                        const finalPage = Math.round(finalPercentage * (mangaInfo.total_pages - 1));
                        if (finalPage !== currentPage.value) {
                            onPageChange(finalPage);
                        }
                    };

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                }

                function onTrackClick(event) {
                    if (isDragging.value) return;

                    const container = sliderContainer.value;
                    const rect = container.getBoundingClientRect();
                    const clickY = event.clientY - rect.top;

                    const containerHeight = container.offsetHeight;
                    const thumbHeight = 30;

                    let percentage = clickY / containerHeight;
                    percentage = (clickY - (thumbHeight / 2)) / (containerHeight - thumbHeight);
                    percentage = Math.max(0, Math.min(1, percentage));

                    const newPage = Math.round(percentage * (mangaInfo.total_pages - 1));

                    if (newPage !== currentPage.value) {
                        onPageChange(newPage);
                    }
                }

                // ==================== 事件处理 ====================

                function handleKeydown(event) {
                    switch (event.key) {
                        case 'ArrowLeft':
                            event.preventDefault();
                            previousPage();
                            break;
                        case 'ArrowRight':
                            event.preventDefault();
                            nextPage();
                            break;
                        case 'Escape':
                            if (isFullscreen.value) {
                                exitFullscreen();
                            }
                            break;
                        case 'F11':
                            event.preventDefault();
                            toggleFullscreen();
                            break;
                    }
                }

                function onImageClick(event) {
                    // 点击图片左半部分上一页，右半部分下一页
                    const rect = event.currentTarget.getBoundingClientRect();
                    const clickX = event.clientX - rect.left;
                    const centerX = rect.width / 2;

                    if (clickX < centerX) {
                        previousPage();
                    } else {
                        nextPage();
                    }
                }

                // ==================== 全屏控制 ====================

                function toggleFullscreen() {
                    if (isFullscreen.value) {
                        exitFullscreen();
                    } else {
                        enterFullscreen();
                    }
                }

                function enterFullscreen() {
                    const element = viewerContent.value;
                    if (element.requestFullscreen) {
                        element.requestFullscreen();
                    } else if (element.webkitRequestFullscreen) {
                        element.webkitRequestFullscreen();
                    } else if (element.msRequestFullscreen) {
                        element.msRequestFullscreen();
                    }
                }

                function exitFullscreen() {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }

                function handleFullscreenChange() {
                    isFullscreen.value = !!document.fullscreenElement;
                }

                function handleWheel(event) {
                    // 滚轮翻页
                    if (event.deltaY > 0) {
                        nextPage();
                    } else {
                        previousPage();
                    }
                    event.preventDefault();
                }

                function handleResize() {
                    screenInfo.width = window.innerWidth;
                    screenInfo.height = window.innerHeight;
                    screenInfo.ratio = window.innerWidth / window.innerHeight;

                    // 如果是自动模式，重新加载页面以适应新的显示模式
                    if (displayMode.value === 'auto') {
                        nextTick(() => {
                            loadCurrentPage();
                        });
                    }
                }

                function isDesktopApp() {
                    return window.location.protocol === 'file:' ||
                           window.navigator.userAgent.includes('Electron') ||
                           window.pywebview !== undefined;
                }

                const displayModeText = computed(() => {
                    const modes = {
                        'auto': '自动',
                        'single': '单页',
                        'double': '双页'
                    };
                    return modes[displayMode.value] || '自动';
                });

                const canPrevious = computed(() => currentPage.value > 0);
                const canNext = computed(() => currentPage.value < mangaInfo.total_pages - 1);

                function onImageLoad() {
                    // 图片加载完成
                }

                function onImageError() {
                    ElMessage.error('图片加载失败');
                }

                // 清理资源
                onUnmounted(() => {
                    document.removeEventListener('keydown', handleKeydown);
                    document.removeEventListener('fullscreenchange', handleFullscreenChange);
                    document.removeEventListener('wheel', handleWheel);
                    window.removeEventListener('resize', handleResize);

                    // 销毁查看器管理器
                    if (viewerManager) {
                        viewerManager.destroySession();
                    }
                });



                function applyPageInput() {
                    const newPage = parseInt(pageInputText.value);
                    if (newPage && newPage >= 1 && newPage <= mangaInfo.total_pages) {
                        onPageChange(newPage - 1); // 转换为0-based
                    } else {
                        pageInputText.value = (currentPage.value + 1).toString();
                    }
                    showPageInput.value = false;
                }

                // ==================== 自定义滑块方法 ====================

                function onThumbMouseDown(event) {
                    isDragging.value = true;
                    const thumb = event.target;
                    const container = sliderContainer.value;
                    const initialY = event.clientY;
                    const initialTop = thumb.offsetTop;

                    const onMouseMove = (moveEvent) => {
                        if (!isDragging.value) return;

                        const deltaY = moveEvent.clientY - initialY;
                        let newTop = initialTop + deltaY;

                        const containerHeight = container.offsetHeight;
                        const thumbHeight = thumb.offsetHeight;
                        
                        // 限制在轨道内
                        newTop = Math.max(0, Math.min(newTop, containerHeight - thumbHeight));
                        
                        const percentage = newTop / (containerHeight - thumbHeight);
                        const newPage = Math.round(percentage * (mangaInfo.total_pages - 1));
                        
                        // 仅更新预览页码，不立即跳转
                        pageInputText.value = (newPage + 1).toString();
                        
                        // 直接更新样式以获得即时反馈
                        thumb.style.top = `${newTop}px`;
                    };

                    const onMouseUp = () => {
                        isDragging.value = false;
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);

                        // 拖动结束后，根据最终位置计算并跳转页面
                        const finalPercentage = thumb.offsetTop / (container.offsetHeight - thumb.offsetHeight);
                        const finalPage = Math.round(finalPercentage * (mangaInfo.total_pages - 1));
                        if (finalPage !== currentPage.value) {
                            onPageChange(finalPage);
                        }
                    };

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                }

                function onTrackClick(event) {
                    if (isDragging.value) return;

                    const container = sliderContainer.value;
                    const rect = container.getBoundingClientRect();
                    const clickY = event.clientY - rect.top;
                    
                    const containerHeight = container.offsetHeight;
                    const thumbHeight = 30; // 硬编码与CSS一致
                    
                    let percentage = clickY / containerHeight;
                    // 调整，使点击中心大致对齐滑块中心
                    percentage = (clickY - (thumbHeight / 2)) / (containerHeight - thumbHeight);
                    percentage = Math.max(0, Math.min(1, percentage));

                    const newPage = Math.round(percentage * (mangaInfo.total_pages - 1));
                    
                    if (newPage !== currentPage.value) {
                        onPageChange(newPage);
                    }
                }
                
                // 监听页码输入框显示状态，自动聚焦
                watch(showPageInput, (newValue) => {
                    if (newValue) {
                        nextTick(() => {
                            if (pageInputRef.value) {
                                pageInputRef.value.focus();
                                pageInputRef.value.select(); // 选中所有文本
                            }
                        });
                    }
                });



                // ==================== 事件处理 ====================

                function handleKeydown(event) {
                    switch (event.key) {
                        case 'ArrowLeft':
                            event.preventDefault();
                            previousPage();
                            break;
                        case 'ArrowRight':
                            event.preventDefault();
                            nextPage();
                            break;
                        case 'Escape':
                            if (isFullscreen.value) {
                                exitFullscreen();
                            }
                            break;
                        case 'F11':
                            event.preventDefault();
                            toggleFullscreen();
                            break;
                    }
                }

                function onImageClick(event) {
                    // 点击图片左半部分上一页，右半部分下一页
                    const rect = event.currentTarget.getBoundingClientRect();
                    const clickX = event.clientX - rect.left;
                    const centerX = rect.width / 2;

                    if (clickX < centerX) {
                        previousPage();
                    } else {
                        nextPage();
                    }
                }

                function onImageLoad() {
                    // 图片加载完成
                }

                function onImageError() {
                    ElMessage.error('图片加载失败');
                }

                // ==================== 全屏控制 ====================

                function toggleFullscreen() {
                    if (isFullscreen.value) {
                        exitFullscreen();
                    } else {
                        enterFullscreen();
                    }
                }

                function enterFullscreen() {
                    const element = viewerContent.value;
                    if (element.requestFullscreen) {
                        element.requestFullscreen();
                    } else if (element.webkitRequestFullscreen) {
                        element.webkitRequestFullscreen();
                    } else if (element.msRequestFullscreen) {
                        element.msRequestFullscreen();
                    }
                }

                function exitFullscreen() {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }

                function handleFullscreenChange() {
                    isFullscreen.value = !!document.fullscreenElement;
                }

                // ==================== 导航 ====================
                // iframe方案不需要返回按钮，由父页面控制关闭

                return {
                    // 数据
                    mangaInfo,
                    currentPage,
                    showPageInput,
                    pageInputText,
                    currentImageUrls,
                    isLoading,
                    isFullscreen,
                    displayMode,
                    actualDisplayMode,
                    translationEnabled,
                    progressPercentage,
                    progressCircumference,
                    progressOffset,
                    screenInfo,
                    thumbStyle,
                    isDragging,
                    displayModeText,
                    canPrevious,
                    canNext,

                    // DOM引用
                    viewerContent,
                    mangaImage,
                    pageInputRef,
                    sliderContainer,

                    // 方法
                    loadCurrentPage,
                    previousPage,
                    nextPage,
                    onPageChange,
                    onPageInputEnter,
                    onPageInputBlur,
                    cancelPageInput,
                    applyPageInput,
                    toggleDisplayMode,
                    toggleTranslation,
                    onImageClick,
                    onImageLoad,
                    onImageError,
                    toggleFullscreen,
                    onThumbMouseDown,
                    onTrackClick
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>

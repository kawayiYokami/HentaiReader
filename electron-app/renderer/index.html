<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼«ç”»ç¿»è¯‘å·¥å…· - æ¡Œé¢ç‰ˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .status-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .status-content {
            font-family: monospace;
            font-size: 12px;
            color: #6c757d;
            white-space: pre-wrap;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .log-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .environment-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        
        .badge-electron {
            background-color: #47b8e0;
            color: white;
        }
        
        .badge-web {
            background-color: #ffc107;
            color: black;
        }
        
        .loading {
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ æ¼«ç”»ç¿»è¯‘å·¥å…·</h1>
            <p>æ¡Œé¢ç‰ˆæµ‹è¯•é¡µé¢</p>
            <div id="environment-info" class="loading">æ­£åœ¨æ£€æµ‹ç¯å¢ƒ...</div>
        </div>

        <div class="status-card">
            <div class="status-title">ğŸ” ç¯å¢ƒä¿¡æ¯</div>
            <div id="environment-details" class="status-content">åŠ è½½ä¸­...</div>
        </div>

        <div class="status-card">
            <div class="status-title">ğŸ PythonæœåŠ¡çŠ¶æ€</div>
            <div id="python-status" class="status-content">æ£€æŸ¥ä¸­...</div>
        </div>

        <div class="status-card">
            <div class="status-title">ğŸ§© é€‚é…å™¨çŠ¶æ€</div>
            <div id="adapter-status" class="status-content">åˆå§‹åŒ–ä¸­...</div>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" onclick="testFileSelection()">ğŸ“ æµ‹è¯•æ–‡ä»¶é€‰æ‹©</button>
            <button class="btn btn-primary" onclick="testMultipleFiles()">ğŸ“‚ æµ‹è¯•å¤šæ–‡ä»¶é€‰æ‹©</button>
            <button class="btn btn-secondary" onclick="testNotification()">ğŸ”” æµ‹è¯•é€šçŸ¥</button>
            <button class="btn btn-secondary" onclick="testProgressBar()">ğŸ“Š æµ‹è¯•è¿›åº¦æ¡</button>
            <button class="btn btn-success" onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="log-area" id="log-area">
            <div>ğŸ“ æµ‹è¯•æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>

    <!-- åŠ è½½é€‚é…å™¨è„šæœ¬ -->
    <script src="js/adapters/EnvironmentDetector.js"></script>
    <script src="js/adapters/FileAPIAdapter.js"></script>
    <script src="js/adapters/ElectronBridge.js"></script>
    <script src="js/adapters/AdapterManager.js"></script>

    <script>
        // æ—¥å¿—åŠŸèƒ½
        function log(message, type = 'info') {
            const logArea = document.getElementById('log-area');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${typeIcon} ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log-area').innerHTML = '<div>ğŸ“ æ—¥å¿—å·²æ¸…ç©º</div>';
        }

        // æ›´æ–°ç¯å¢ƒä¿¡æ¯
        function updateEnvironmentInfo() {
            const envInfo = EnvironmentDetector.getEnvironmentInfo();
            
            // æ›´æ–°ç¯å¢ƒå¾½ç« 
            const envBadge = document.getElementById('environment-info');
            if (envInfo.isElectron) {
                envBadge.innerHTML = '<span class="environment-badge badge-electron">âš¡ Electronç¯å¢ƒ</span>';
            } else {
                envBadge.innerHTML = '<span class="environment-badge badge-web">ğŸŒ Webç¯å¢ƒ</span>';
            }
            
            // æ›´æ–°è¯¦ç»†ä¿¡æ¯
            document.getElementById('environment-details').textContent = JSON.stringify(envInfo, null, 2);
            
            log(`ç¯å¢ƒæ£€æµ‹å®Œæˆ: ${envInfo.isElectron ? 'Electron' : 'Web'}`, 'success');
        }

        // æ›´æ–°PythonæœåŠ¡çŠ¶æ€
        async function updatePythonStatus() {
            try {
                if (window.electronBridge) {
                    const status = await window.electronBridge.getPythonStatus();
                    document.getElementById('python-status').textContent = JSON.stringify(status, null, 2);
                    log(`PythonæœåŠ¡çŠ¶æ€: ${status.isRunning ? 'è¿è¡Œä¸­' : 'æœªè¿è¡Œ'}`, status.isRunning ? 'success' : 'warning');
                } else {
                    document.getElementById('python-status').textContent = 'ç­‰å¾…é€‚é…å™¨åˆå§‹åŒ–...';
                }
            } catch (error) {
                document.getElementById('python-status').textContent = `é”™è¯¯: ${error.message}`;
                log(`è·å–PythonçŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ›´æ–°é€‚é…å™¨çŠ¶æ€
        function updateAdapterStatus() {
            if (window.adapterManager && window.adapterManager.isReady()) {
                const capabilities = window.adapterManager.getCapabilities();
                document.getElementById('adapter-status').textContent = JSON.stringify(capabilities, null, 2);
                log('é€‚é…å™¨åˆå§‹åŒ–å®Œæˆ', 'success');
            } else {
                document.getElementById('adapter-status').textContent = 'é€‚é…å™¨æœªå°±ç»ª';
                log('é€‚é…å™¨æœªå°±ç»ª', 'warning');
            }
        }

        // æµ‹è¯•æ–‡ä»¶é€‰æ‹©
        async function testFileSelection() {
            try {
                log('å¼€å§‹æµ‹è¯•æ–‡ä»¶é€‰æ‹©...');
                const result = await window.fileAPI.selectFile({
                    accept: '.zip,.rar,.cbz,.cbr'
                });
                
                if (result) {
                    log(`æ–‡ä»¶é€‰æ‹©æˆåŠŸ: ${result.name || result.file?.name}`, 'success');
                } else {
                    log('ç”¨æˆ·å–æ¶ˆäº†æ–‡ä»¶é€‰æ‹©', 'warning');
                }
            } catch (error) {
                log(`æ–‡ä»¶é€‰æ‹©å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å¤šæ–‡ä»¶é€‰æ‹©
        async function testMultipleFiles() {
            try {
                log('å¼€å§‹æµ‹è¯•å¤šæ–‡ä»¶é€‰æ‹©...');
                const results = await window.fileAPI.selectMultipleFiles({
                    accept: '.zip,.rar,.cbz,.cbr'
                });
                
                if (results && results.length > 0) {
                    log(`å¤šæ–‡ä»¶é€‰æ‹©æˆåŠŸ: é€‰æ‹©äº† ${results.length} ä¸ªæ–‡ä»¶`, 'success');
                } else {
                    log('ç”¨æˆ·å–æ¶ˆäº†å¤šæ–‡ä»¶é€‰æ‹©', 'warning');
                }
            } catch (error) {
                log(`å¤šæ–‡ä»¶é€‰æ‹©å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•é€šçŸ¥
        async function testNotification() {
            try {
                log('æµ‹è¯•ç³»ç»Ÿé€šçŸ¥...');
                const success = await window.electronBridge.showNotification(
                    'æµ‹è¯•é€šçŸ¥',
                    'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é€šçŸ¥æ¶ˆæ¯'
                );
                
                if (success) {
                    log('é€šçŸ¥å‘é€æˆåŠŸ', 'success');
                } else {
                    log('é€šçŸ¥å‘é€å¤±è´¥æˆ–è¢«é˜»æ­¢', 'warning');
                }
            } catch (error) {
                log(`é€šçŸ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•è¿›åº¦æ¡
        async function testProgressBar() {
            try {
                log('æµ‹è¯•è¿›åº¦æ¡...');
                
                for (let i = 0; i <= 100; i += 10) {
                    await window.electronBridge.setProgressBar(i / 100);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // æ¸…é™¤è¿›åº¦æ¡
                await window.electronBridge.setProgressBar(-1);
                log('è¿›åº¦æ¡æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                log(`è¿›åº¦æ¡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // äº‹ä»¶ç›‘å¬
        window.addEventListener('adapters-ready', (event) => {
            log('é€‚é…å™¨å°±ç»ªäº‹ä»¶è§¦å‘', 'success');
            updateAdapterStatus();
            updatePythonStatus();
        });

        window.addEventListener('adapters-error', (event) => {
            log(`é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥: ${event.detail.error}`, 'error');
        });

        window.addEventListener('adapter-status-change', (event) => {
            log(`é€‚é…å™¨çŠ¶æ€å˜åŒ–: ${event.detail.type}`, 'info');
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ', 'info');
            updateEnvironmentInfo();
            
            // å®šæœŸæ›´æ–°çŠ¶æ€
            setInterval(() => {
                if (window.adapterManager && window.adapterManager.isReady()) {
                    updatePythonStatus();
                }
            }, 5000);
        });
    </script>
</body>
</html>
